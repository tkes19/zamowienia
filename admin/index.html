<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administratora - Rezon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../assets/vendor/fontawesome/all.min.css">
    <style>
        /* Style dla tooltipa z dostępnymi miejscowościami */
        #available-cities-tooltip {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            opacity: 0;
            transform: translateY(5px);
            transition: opacity 0.2s ease, transform 0.2s ease;
            pointer-events: none;
        }
        
        .group:hover #available-cities-tooltip {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        #available-cities-trigger {
            transition: border-color 0.2s ease;
        }
        
        #available-cities-trigger:hover {
            border-color: #4B5563;
        }
        
        /* Dla lepszej widoczności na ciemnych motywach */
        @media (prefers-color-scheme: dark) {
            #available-cities-tooltip {
                background-color: #1F2937;
                border-color: #374151;
                color: #E5E7EB;
            }
            
            #available-cities-tooltip div {
                color: #E5E7EB;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-md flex flex-col">
            <div class="p-6 border-b">
                <h1 class="text-2xl font-bold text-gray-800">Rezon Admin</h1>
                <p class="text-sm text-gray-500">Panel zarządzania</p>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors" data-view="dashboard">
                    <i class="fas fa-home w-5"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-blue-600 bg-blue-50 rounded-lg font-medium" data-view="products">
                    <i class="fas fa-boxes w-5"></i>
                    <span>Produkty i Magazyn</span>
                </a>
                <a href="/clients" class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-users-cog w-5"></i>
                    <span>Moi Klienci</span>
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors" data-view="orders">
                    <i class="fas fa-receipt w-5"></i>
                    <span>Zamówienia</span>
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors" data-view="users">
                    <i class="fas fa-users w-5"></i>
                    <span>Użytkownicy</span>
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors" data-view="folder-access">
                    <i class="fas fa-folder-open w-5"></i>
                    <span>Foldery KI</span>
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors" data-view="city-access">
                    <i class="fas fa-map-marker-alt w-5"></i>
                    <span>Miejscowości PM</span>
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors" data-view="product-mapping">
                    <i class="fas fa-link w-5"></i>
                    <span>Mapowanie produktów</span>
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors" data-view="settings">
                    <i class="fas fa-cog w-5"></i>
                    <span>Ustawienia</span>
                </a>
            </nav>
            <div class="p-4 border-t space-y-2">
                <a href="/" class="flex items-center gap-3 px-4 py-2 text-sm text-gray-600 hover:text-gray-900">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Nowe zamówienie</span>
                </a>
                <a href="/clients" class="flex items-center gap-3 px-4 py-2 text-sm text-gray-600 hover:text-gray-900">
                    <i class="fas fa-users-cog"></i>
                    <span>Moi klienci</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-auto p-8">
            <!-- Widok: Produkty i Magazyn -->
            <div id="view-products" class="view-container">
            <!-- Header -->
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">Produkty i Magazyn</h2>
                    <p class="text-gray-600 mt-1">Zarządzanie stanami magazynowymi produktów</p>
                </div>
                <div class="flex gap-3">
                    <button id="new-product-btn" class="px-3 py-1.5 bg-green-600 text-white rounded-full hover:bg-green-700 flex items-center gap-2 text-sm shadow-sm transition-colors">
                        <i class="fas fa-plus"></i> Nowy produkt
                    </button>
                    <button id="refresh-btn" class="px-3 py-1.5 bg-white border border-gray-300 rounded-full text-gray-700 hover:bg-gray-50 flex items-center gap-2 text-sm shadow-sm">
                        <i class="fas fa-sync-alt"></i> Odśwież
                    </button>
                    <button id="sync-btn" class="px-3 py-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 flex items-center gap-2 text-sm shadow-sm transition-colors">
                        <i class="fas fa-cloud-download-alt"></i> Pobierz z API
                    </button>
                </div>
            </header>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div class="text-gray-500 text-sm font-medium uppercase tracking-wider mb-1">Wszystkie produkty</div>
                    <div class="text-3xl font-bold text-gray-800" id="stats-total">0</div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div class="text-gray-500 text-sm font-medium uppercase tracking-wider mb-1">Niski stan</div>
                    <div class="text-3xl font-bold text-amber-600" id="stats-low">0</div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div class="text-gray-500 text-sm font-medium uppercase tracking-wider mb-1">Brak w magazynie</div>
                    <div class="text-3xl font-bold text-red-600" id="stats-out">0</div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div class="text-gray-500 text-sm font-medium uppercase tracking-wider mb-1">Wartość magazynu</div>
                    <div class="text-3xl font-bold text-green-600" id="stats-value">-</div>
                </div>
            </div>

            <!-- Search & Filters -->
            <div class="bg-white p-4 rounded-t-xl border-b border-gray-200 flex flex-col sm:flex-row gap-4 justify-between items-center shadow-sm">
                <div class="relative w-full sm:w-96">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="search-input" placeholder="Szukaj po nazwie, indeksie lub ID..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="flex gap-2">
                    <select id="category-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                        <option value="">Wszystkie kategorie</option>
                        <!-- Kategorie będą dynamiczne -->
                    </select>
                </div>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-b-xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-semibold tracking-wider border-b border-gray-200">
                            <tr>
                                <th class="p-4 w-16">Img</th>
                                <th class="p-4">Identyfikator / Indeks</th>
                                <th class="p-4">Kategoria</th>
                                <th class="p-4 text-right">Cena</th>
                                <th class="p-4 text-center">Stan</th>
                                <th class="p-4 text-center">Rezerwacje</th>
                                <th class="p-4 text-center">Dostępne</th>
                                <th class="p-4 text-center">Status</th>
                                <th class="p-4 text-right">Akcje</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body" class="divide-y divide-gray-100 text-sm">
                            <tr>
                                <td colspan="9" class="p-8 text-center text-gray-500">
                                    <div class="flex flex-col items-center gap-2">
                                        <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                                        <span>Ładowanie danych...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="p-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center">
                    <div class="text-sm text-gray-500" id="table-info">Pokazuje 0 z 0 produktów</div>
                    <div class="flex gap-2">
                        <button class="px-3 py-1 border border-gray-300 rounded bg-white text-gray-600 disabled:opacity-50" disabled>Poprzednia</button>
                        <button class="px-3 py-1 border border-gray-300 rounded bg-white text-gray-600 disabled:opacity-50" disabled>Następna</button>
                    </div>
                </div>
            </div>
            </div>
            <!-- Koniec widoku: Produkty i Magazyn -->

            <!-- Widok: Zamówienia -->
            <div id="view-orders" class="view-container hidden">
                <header class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">Zamówienia</h2>
                        <p class="text-gray-600 mt-1">Przegląd i zarządzanie zamówieniami</p>
                    </div>
                    <div class="flex gap-3">
                        <button id="export-orders-csv-btn" class="px-3 py-1.5 bg-green-600 text-white rounded-full hover:bg-green-700 flex items-center gap-2 text-sm shadow-sm transition-colors">
                            <i class="fas fa-file-csv"></i> Eksport CSV
                        </button>
                        <button id="refresh-orders-btn" class="px-3 py-1.5 bg-white border border-gray-300 rounded-full text-gray-700 hover:bg-gray-50 flex items-center gap-2 text-sm shadow-sm">
                            <i class="fas fa-sync-alt"></i> Odśwież
                        </button>
                    </div>
                </header>

                <!-- Filtry -->
                <div class="bg-white p-4 rounded-t-xl border-b border-gray-200 flex flex-col sm:flex-row gap-4 justify-between items-center shadow-sm">
                    <div class="relative w-full sm:w-96">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="orders-search-input" placeholder="Szukaj po numerze, kliencie..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="flex gap-2">
                        <select id="orders-status-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                            <option value="">Wszystkie statusy</option>
                            <option value="PENDING">Oczekujące</option>
                            <option value="APPROVED">Zatwierdzone</option>
                            <option value="IN_PRODUCTION">W produkcji</option>
                            <option value="READY">Gotowe</option>
                            <option value="SHIPPED">Wysłane</option>
                            <option value="DELIVERED">Dostarczone</option>
                            <option value="CANCELLED">Anulowane</option>
                        </select>
                        <select id="orders-user-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                            <option value="">Wszyscy handlowcy</option>
                        </select>
                    </div>
                </div>

                <!-- Tabela zamówień -->
                <div class="bg-white rounded-b-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead id="orders-table-head" class="bg-gray-50 text-gray-600 uppercase text-xs font-semibold tracking-wider border-b border-gray-200">
                                <tr>
                                    <th class="p-4 w-8"></th>
                                    <th class="p-4 sortable-header cursor-pointer hover:bg-gray-100" data-sort="orderNumber">
                                        Numer zamówienia <i class="fas fa-sort sort-icon ml-1 opacity-50"></i>
                                    </th>
                                    <th class="p-4 sortable-header cursor-pointer hover:bg-gray-100" data-sort="createdAt">
                                        Data <i class="fas fa-sort-down sort-icon ml-1 active"></i>
                                    </th>
                                    <th class="p-4 sortable-header cursor-pointer hover:bg-gray-100" data-sort="customer">
                                        Klient <i class="fas fa-sort sort-icon ml-1 opacity-50"></i>
                                    </th>
                                    <th class="p-4">Handlowiec</th>
                                    <th class="p-4 sortable-header cursor-pointer hover:bg-gray-100" data-sort="status">
                                        Status <i class="fas fa-sort sort-icon ml-1 opacity-50"></i>
                                    </th>
                                    <th class="p-4 text-right sortable-header cursor-pointer hover:bg-gray-100" data-sort="total">
                                        Suma <i class="fas fa-sort sort-icon ml-1 opacity-50"></i>
                                    </th>
                                    <th class="p-4 text-right">Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body" class="divide-y divide-gray-100 text-sm">
                                <tr>
                                    <td colspan="8" class="p-8 text-center text-gray-500">
                                        <div class="flex flex-col items-center gap-2">
                                            <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                                            <span>Ładowanie zamówień...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="p-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center">
                        <div class="text-sm text-gray-500" id="orders-table-info">Pokazuje 0 z 0 zamówień</div>
                    </div>
                </div>
            </div>
            <!-- Koniec widoku: Zamówienia -->

            <!-- Print Preview Modal -->
            <div id="admin-print-preview-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-5xl border border-gray-200 max-h-[95vh] overflow-hidden flex flex-col">
                    <div class="flex justify-between items-center px-6 py-4 border-b bg-gray-50">
                        <h3 class="text-lg font-semibold text-gray-800">Podgląd wydruku</h3>
                        <div class="flex gap-2">
                            <button id="admin-print-preview-print" class="px-3 py-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 flex items-center gap-2 text-sm font-medium transition-colors">
                                <i class="fas fa-print"></i> Drukuj
                            </button>
                            <button id="admin-print-preview-close" class="px-3 py-1.5 bg-gray-300 text-gray-700 rounded-full hover:bg-gray-400 text-sm font-medium transition-colors">
                                Zamknij
                            </button>
                        </div>
                    </div>
                    <div id="admin-print-preview-content" class="flex-1 overflow-y-auto bg-gray-100 p-8"></div>
                </div>
            </div>

            <!-- Delete Confirm Modal -->
            <div id="delete-order-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Potwierdź usunięcie</h3>
                    <p class="text-gray-600 mb-6">Czy na pewno chcesz usunąć zamówienie <strong id="delete-order-number"></strong>? Ta operacja jest nieodwracalna.</p>
                    <div class="flex gap-3 justify-end">
                        <button id="delete-order-cancel" class="px-3 py-1.5 bg-gray-300 text-gray-700 rounded-full hover:bg-gray-400 text-sm font-medium transition-colors">
                            Anuluj
                        </button>
                        <button id="delete-order-confirm" class="px-3 py-1.5 bg-red-600 text-white rounded-full hover:bg-red-700 text-sm font-medium transition-colors">
                            <i class="fas fa-trash"></i> Usuń
                        </button>
                    </div>
                </div>
            </div>

            <!-- Edit Order Modal -->
            <div id="edit-order-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden flex flex-col">
                    <div class="flex justify-between items-center px-6 py-4 border-b bg-gray-50">
                        <h3 class="text-lg font-semibold text-gray-800">Edytuj zamówienie <span id="edit-order-number"></span></h3>
                        <button id="edit-order-close" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="edit-order-content" class="flex-1 overflow-y-auto p-6">
                        <div class="flex justify-center items-center h-32">
                            <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                            <span class="ml-2 text-gray-500">Ładowanie...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Widok: Użytkownicy -->
            <div id="view-users" class="view-container hidden">
                <header class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">Zarządzanie użytkownikami</h2>
                        <p class="text-gray-600 mt-1">Przypisuj role i zarządzaj uprawnieniami użytkowników</p>
                    </div>
                    <div class="flex gap-3">
                        <button id="new-user-btn" class="px-3 py-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 flex items-center gap-2 text-sm shadow-sm transition-colors">
                            <i class="fas fa-user-plus"></i> Dodaj użytkownika
                        </button>
                        <button id="refresh-users-btn" class="px-3 py-1.5 bg-white border border-gray-300 rounded-full text-gray-700 hover:bg-gray-50 flex items-center gap-2 text-sm shadow-sm">
                            <i class="fas fa-sync-alt"></i> Odśwież
                        </button>
                    </div>
                </header>

                <!-- Filtry -->
                <div class="bg-white p-4 rounded-t-xl border-b border-gray-200 flex flex-col sm:flex-row gap-4 justify-between items-center shadow-sm">
                    <div class="relative w-full sm:w-96">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="users-search-input" placeholder="Szukaj po nazwie lub emailu..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="flex gap-2">
                        <select id="users-role-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                            <option value="">Wszystkie role</option>
                        </select>
                        <select id="users-department-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                            <option value="">Wszystkie działy</option>
                        </select>
                    </div>
                </div>

                <!-- Tabela użytkowników -->
                <div class="bg-white rounded-b-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-semibold tracking-wider border-b border-gray-200">
                                <tr>
                                    <th class="p-4">Imię i nazwisko</th>
                                    <th class="p-4">Email</th>
                                    <th class="p-4">Rola</th>
                                    <th class="p-4">Dział</th>
                                    <th class="p-4 text-center">Status</th>
                                    <th class="p-4 text-center">Data utworzenia</th>
                                    <th class="p-4 text-right">Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body" class="divide-y divide-gray-100 text-sm">
                                <tr>
                                    <td colspan="7" class="p-8 text-center text-gray-500">
                                        <div class="flex flex-col items-center gap-2">
                                            <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                                            <span>Ładowanie danych...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="p-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center">
                        <div class="text-sm text-gray-500" id="users-table-info">Pokazuje 0 z 0 użytkowników</div>
                    </div>
                </div>

                <!-- Informacje o rolach -->
                <div class="mt-8 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Informacje o rolach</h3>
                    <p class="text-sm text-gray-600 mb-4">Opis uprawnień dla każdej roli w systemie:</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-user-shield text-red-600"></i>
                                <h4 class="font-semibold text-gray-800">Administrator</h4>
                            </div>
                            <p class="text-sm text-gray-600">Pełny dostęp do wszystkich funkcji systemu, zarządzanie użytkownikami i produktami.</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-user-tie text-blue-600"></i>
                                <h4 class="font-semibold text-gray-800">Handlowiec</h4>
                            </div>
                            <p class="text-sm text-gray-600">Składanie zamówień, zarządzanie swoimi klientami, przeglądanie katalog produktów.</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-warehouse text-amber-600"></i>
                                <h4 class="font-semibold text-gray-800">Magazyn</h4>
                            </div>
                            <p class="text-sm text-gray-600">Zarządzanie stanami magazynowymi, aktualizacja statusów zamówień.</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-users text-green-600"></i>
                                <h4 class="font-semibold text-gray-800">Dział Sprzedaży</h4>
                            </div>
                            <p class="text-sm text-gray-600">Nadzór nad procesem sprzedaży, dostęp do wszystkich zamówień i klientów.</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-industry text-purple-600"></i>
                                <h4 class="font-semibold text-gray-800">Produkcja</h4>
                            </div>
                            <p class="text-sm text-gray-600">Dostęp do zleceń produkcyjnych, zarządzanie procesem produkcji.</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-palette text-pink-600"></i>
                                <h4 class="font-semibold text-gray-800">Graficy</h4>
                            </div>
                            <p class="text-sm text-gray-600">Dostęp do projektów graficznych, przygotowanie plików do produkcji.</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-user-clock text-gray-500"></i>
                                <h4 class="font-semibold text-gray-800">Nowy Użytkownik</h4>
                            </div>
                            <p class="text-sm text-gray-600">Ograniczony dostęp, wymaga aktywacji przez administratora.</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Koniec widoku: Użytkownicy -->

            <!-- Widok: Foldery KI -->
            <div id="view-folder-access" class="view-container hidden">
                <header class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">Przypisania folderów KI</h2>
                        <p class="text-gray-600 mt-1">Zarządzaj dostępem handlowców do folderów klientów indywidualnych</p>
                    </div>
                    <div class="flex gap-3">
                        <button id="new-folder-access-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-sm transition-colors">
                            <i class="fas fa-plus"></i> Dodaj przypisanie
                        </button>
                        <button id="refresh-folder-access-btn" class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center gap-2 shadow-sm">
                            <i class="fas fa-sync-alt"></i> Odśwież
                        </button>
                    </div>
                </header>

                <!-- Statystyki -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-green-100 rounded-lg">
                                <i class="fas fa-check-circle text-green-600"></i>
                            </div>
                            <div>
                                <div class="text-gray-500 text-sm font-medium">Aktywne przypisania</div>
                                <div class="text-2xl font-bold text-green-600" id="folder-stats-active">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <i class="fas fa-users text-blue-600"></i>
                            </div>
                            <div>
                                <div class="text-gray-500 text-sm font-medium">Użytkowników z dostępem</div>
                                <div class="text-2xl font-bold text-blue-600" id="folder-stats-users">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-purple-100 rounded-lg">
                                <i class="fas fa-folder text-purple-600"></i>
                            </div>
                            <div>
                                <div class="text-gray-500 text-sm font-medium">Unikalnych folderów</div>
                                <div class="text-2xl font-bold text-purple-600" id="folder-stats-folders">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtry -->
                <div class="bg-white p-4 rounded-t-xl border-b border-gray-200 flex flex-col sm:flex-row gap-4 justify-between items-center shadow-sm">
                    <div class="relative w-full sm:w-96">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="folder-access-search" placeholder="Szukaj po użytkowniku lub folderze..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="flex gap-2">
                        <select id="folder-access-user-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                            <option value="">Wszyscy użytkownicy</option>
                        </select>
                        <select id="folder-access-status-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                            <option value="">Wszystkie statusy</option>
                            <option value="active">Aktywne</option>
                            <option value="inactive">Nieaktywne</option>
                        </select>
                    </div>
                </div>

                <!-- Tabela przypisań -->
                <div class="bg-white rounded-b-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-semibold tracking-wider border-b border-gray-200">
                                <tr>
                                    <th class="p-4">Użytkownik</th>
                                    <th class="p-4">Folder KI</th>
                                    <th class="p-4 text-center">Status</th>
                                    <th class="p-4">Przypisał</th>
                                    <th class="p-4">Data</th>
                                    <th class="p-4">Notatki</th>
                                    <th class="p-4 text-right">Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="folder-access-table-body" class="divide-y divide-gray-100 text-sm">
                                <tr>
                                    <td colspan="7" class="p-8 text-center text-gray-500">
                                        <div class="flex flex-col items-center gap-2">
                                            <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                                            <span>Ładowanie danych...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="p-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center">
                        <div class="text-sm text-gray-500" id="folder-access-table-info">Pokazuje 0 przypisań</div>
                    </div>
                </div>

                <!-- Informacje -->
                <div class="mt-8 bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-blue-800 mb-2 flex items-center gap-2">
                        <i class="fas fa-info-circle"></i> Jak działają przypisania folderów?
                    </h3>
                    <ul class="text-sm text-blue-700 space-y-1 list-disc list-inside">
                        <li>Handlowiec widzi w trybie KI tylko foldery, do których ma aktywne przypisanie</li>
                        <li>Administrator i Dział Sprzedaży widzą wszystkie foldery z QNAP</li>
                        <li>Dezaktywowane przypisanie można reaktywować bez utraty danych</li>
                        <li>Jeden użytkownik może mieć dostęp do wielu folderów</li>
                    </ul>
                </div>
            </div>
            <!-- Koniec widoku: Foldery KI -->

            <!-- Widok: Miejscowości PM -->
            <div id="view-city-access" class="view-container hidden">
                <header class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">Przypisania miejscowości PM</h2>
                        <p class="text-gray-600 mt-1">Kliknij kafelek, aby przypisać lub usunąć miejscowość</p>
                    </div>
                    <div class="flex gap-3">
                        <button id="city-access-print-btn" class="px-3 py-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 flex items-center gap-2 text-sm shadow-sm transition-colors">
                            <i class="fas fa-print"></i> Podgląd wydruku
                        </button>
                        <button id="city-access-export-csv-btn" class="px-3 py-1.5 bg-green-600 text-white rounded-full hover:bg-green-700 flex items-center gap-2 text-sm shadow-sm transition-colors">
                            <i class="fas fa-file-csv"></i> Eksport CSV
                        </button>
                        <button id="refresh-city-access-btn" class="px-3 py-1.5 bg-white border border-gray-300 rounded-full text-gray-700 hover:bg-gray-50 flex items-center gap-2 text-sm shadow-sm">
                            <i class="fas fa-sync-alt"></i> Odśwież
                        </button>
                    </div>
                </header>

                <!-- Wybór użytkownika i statystyki -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-6">
                    <div class="flex flex-col lg:flex-row gap-6 items-start lg:items-center justify-between">
                        <div class="flex-1 w-full lg:w-auto">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-user mr-1"></i> Wybierz użytkownika do zarządzania
                            </label>
                            <select id="city-access-user-select" class="w-full lg:w-96 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 text-lg">
                                <option value="">-- Wybierz handlowca --</option>
                            </select>
                        </div>
                        <div class="flex gap-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-600" id="city-stats-assigned">0</div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide">Przypisanych</div>
                            </div>
                            <div class="text-center group relative">
                                <div class="text-3xl font-bold text-gray-400" id="city-stats-available">0</div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide">
                                    <span class="cursor-help border-b border-dashed border-gray-400 hover:border-gray-600 transition-colors" 
                                          id="available-cities-trigger" 
                                          title="Kliknij, aby zobaczyć listę">
                                        Dostępnych
                                    </span>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-600" id="city-stats-total">0</div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide">Wszystkich</div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3 flex flex-col sm:flex-row items-start sm:items-center justify-between text-xs text-gray-500">
                        <div>
                            <div id="city-stats-mode" class="mb-1 sm:mb-0 italic">
                                Widok globalny – statystyki dla całego systemu
                            </div>
                            <div id="city-user-summary" class="text-[11px] text-gray-500 hidden"></div>
                        </div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <button id="shared-cities-trigger" class="inline-flex items-center gap-1 text-amber-600 hover:text-amber-700">
                                <i class="fas fa-users"></i>
                                <span>Współdzielone miejscowości:</span>
                                <span id="city-stats-shared">0</span>
                            </button>
                            <button id="recent-assignments-trigger" class="inline-flex items-center gap-1 text-blue-600 hover:text-blue-700">
                                <i class="fas fa-clock"></i>
                                <span>Nowe przypisania 30 dni:</span>
                                <span id="city-stats-recent">0</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Wyszukiwarka i sortowanie -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6">
                    <div class="flex flex-col sm:flex-row gap-4 items-center justify-between">
                        <div class="relative w-full sm:w-96">
                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="city-tiles-search" placeholder="Szukaj miejscowości..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div class="flex gap-2 items-center">
                            <span class="text-sm text-gray-500">Sortuj:</span>
                            <select id="city-tiles-sort" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 text-sm">
                                <option value="alpha">Alfabetycznie</option>
                                <option value="assigned-first">Przypisane najpierw</option>
                                <option value="unassigned-first">Dostępne najpierw</option>
                                <option value="recent-first">Najnowsze przypisania</option>
                            </select>
                            <label class="flex items-center gap-2 ml-4 text-sm text-gray-600">
                                <input type="checkbox" id="city-tiles-show-assigned-only" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                Tylko przypisane
                            </label>
                        </div>
                    </div>
                    <div class="mt-3 w-full flex flex-col sm:flex-row gap-3 sm:items-center justify-between text-xs text-gray-600">
                        <div class="flex flex-wrap gap-3">
                            <label class="flex items-center gap-1.5">
                                <input type="checkbox" id="city-filter-shared" class="h-3.5 w-3.5 text-amber-600 border-gray-300 rounded">
                                <span>Współdzielone miejscowości</span>
                            </label>
                            <label class="flex items-center gap-1.5">
                                <input type="checkbox" id="city-filter-new" class="h-3.5 w-3.5 text-blue-600 border-gray-300 rounded">
                                <span>Nowe przypisania 30 dni</span>
                            </label>
                            <label class="flex items-center gap-1.5">
                                <input type="checkbox" id="city-filter-unassigned-global" class="h-3.5 w-3.5 text-orange-500 border-gray-300 rounded">
                                <span>Bez przypisań globalnie</span>
                            </label>
                        </div>
                        <div class="mt-1 sm:mt-0 flex items-center gap-3 text-[11px] text-gray-400">
                            <button id="city-filters-clear-btn" type="button" class="px-2.5 py-1 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-800 text-[11px] flex items-center gap-1">
                                <i class="fas fa-eraser text-[10px]"></i>
                                <span>Wyczyść filtry</span>
                            </button>
                            <span>Filtry działają na wszystkie miejscowości w systemie.</span>
                        </div>
                    </div>
                </div>

                <!-- Kontener na kafelki -->
                <div id="city-tiles-container" class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 min-h-[400px]">
                    <div class="flex flex-col items-center justify-center h-64 text-gray-400">
                        <i class="fas fa-user-circle text-6xl mb-4"></i>
                        <p class="text-lg">Wybierz użytkownika, aby zobaczyć miejscowości</p>
                    </div>
                </div>

                <!-- Legenda -->
                <div class="mt-6 flex flex-wrap gap-6 justify-center text-sm">
                    <div class="flex items-center gap-2">
                        <div class="w-6 h-6 rounded bg-green-500 shadow-md"></div>
                        <span class="text-gray-600">Przypisana</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-6 h-6 rounded bg-gray-200 border border-gray-300 relative">
                            <span class="absolute -top-1 -right-1 w-2 h-2 bg-orange-400 rounded-full"></span>
                        </div>
                        <span class="text-gray-600">Nieprzypisana</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-mouse-pointer text-gray-400"></i>
                        <span class="text-gray-600">Kliknij, aby zmienić status</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-orange-400 rounded-full"></span>
                        <span class="text-gray-500 text-xs">Pomarańczowa kropka = nieprzypisana do żadnego handlowca</span>
                    </div>
                </div>

                <div id="city-ranking-container" class="mt-8 bg-white rounded-xl shadow-sm border border-gray-100 p-6 hidden">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-trophy text-amber-500"></i>
                            <h3 class="text-lg font-semibold text-gray-800">Ranking przypisań miejscowości</h3>
                        </div>
                        <span class="text-xs text-gray-500">Widok globalny</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-arrow-up text-green-500"></i>
                                <span class="font-semibold text-gray-700">Najwięcej miejscowości</span>
                            </div>
                            <div id="city-ranking-top" class="space-y-1 text-sm text-gray-700"></div>
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-arrow-down text-red-500"></i>
                                <span class="font-semibold text-gray-700">Najmniej miejscowości</span>
                            </div>
                            <div id="city-ranking-bottom" class="space-y-1 text-sm text-gray-700"></div>
                        </div>
                    </div>
                    <p class="mt-3 text-xs text-gray-500">
                        Kliknij w handlowca, aby przejść do jego widoku miejscowości.
                    </p>
                </div>

                <!-- Informacje -->
                <div class="mt-8 bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-blue-800 mb-2 flex items-center gap-2">
                        <i class="fas fa-info-circle"></i> Jak działają przypisania miejscowości?
                    </h3>
                    <ul class="text-sm text-blue-700 space-y-1 list-disc list-inside">
                        <li>Handlowiec widzi w trybie PM tylko miejscowości, do których ma aktywne przypisanie</li>
                        <li>Handlowiec bez przypisań widzi wszystkie miejscowości, ale tylko do podglądu (nie może składać zamówień)</li>
                        <li>Administrator i Dział Sprzedaży widzą wszystkie miejscowości z QNAP</li>
                        <li>Kliknij zielony kafelek, aby usunąć przypisanie • Kliknij szary, aby przypisać</li>
                    </ul>
                </div>
            </div>
            <!-- Koniec widoku: Miejscowości PM -->

            <!-- Widok: Mapowanie produktów -->
            <div id="view-product-mapping" class="view-container hidden">
                <header class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">Mapowanie produktów</h2>
                        <p class="text-gray-600 mt-1">Przypisuj produkty z bazy do projektów graficznych z galerii</p>
                    </div>
                    <div class="flex gap-3">
                        <button id="refresh-product-mapping-btn" class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center gap-2 shadow-sm">
                            <i class="fas fa-sync-alt"></i> Odśwież
                        </button>
                    </div>
                </header>

                <!-- Statystyki -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-6">
                    <div class="flex flex-col sm:flex-row gap-6 items-center justify-between">
                        <div class="relative w-full sm:w-96">
                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="product-mapping-search" placeholder="Szukaj projektu..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div class="flex gap-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-600" id="pm-stats-projects">0</div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide">Projektów</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-green-600" id="pm-stats-mapped">0</div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide">Z przypisaniami</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-orange-500" id="pm-stats-unmapped">0</div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide">Bez przypisań</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Główny layout: tabela projektów + panel szczegółów -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Lewa kolumna: lista projektów -->
                    <div class="lg:col-span-1 bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                            <h3 class="font-semibold text-gray-700">Projekty graficzne</h3>
                        </div>
                        <div class="overflow-y-auto max-h-[500px]" id="product-mapping-projects-list">
                            <div class="p-8 text-center text-gray-400">
                                <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                <p>Ładowanie projektów...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Prawa kolumna: szczegóły projektu -->
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="font-semibold text-gray-700" id="pm-selected-project-name">Wybierz projekt</h3>
                            <button id="pm-add-product-btn" class="px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 flex items-center gap-1 hidden">
                                <i class="fas fa-plus"></i> Dodaj produkt
                            </button>
                        </div>
                        <div id="pm-project-details" class="p-6">
                            <div class="flex flex-col items-center justify-center h-48 text-gray-400">
                                <i class="fas fa-hand-pointer text-4xl mb-3"></i>
                                <p>Kliknij projekt z listy, aby zobaczyć przypisane produkty</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Informacje -->
                <div class="mt-8 bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-blue-800 mb-2 flex items-center gap-2">
                        <i class="fas fa-info-circle"></i> Jak działa mapowanie produktów?
                    </h3>
                    <ul class="text-sm text-blue-700 space-y-1 list-disc list-inside">
                        <li>Projekty graficzne (np. KUBEK_GRAWER) są automatycznie tworzone przy pierwszym wyświetleniu galerii</li>
                        <li>Przypisz produkty z bazy danych do projektu, aby pojawiły się w liście produktów w formularzu zamówienia</li>
                        <li>Jeden projekt może mieć wiele przypisanych produktów (np. różne rozmiary kubków)</li>
                        <li>Produkty bez przypisania do projektu nie będą widoczne w galerii</li>
                    </ul>
                </div>
            </div>
            <!-- Koniec widoku: Mapowanie produktów -->
        </main>
    </div>

    <!-- Modal przypisania miejscowości -->
    <div id="city-access-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-lg border border-gray-200">
            <div class="flex justify-between items-center px-6 py-4 border-b">
                <h3 id="city-access-modal-title" class="text-lg font-semibold text-gray-800">Nowe przypisanie miejscowości</h3>
                <button id="city-access-modal-close" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="city-access-form" class="px-6 py-4 space-y-4">
                <input type="hidden" name="id" value="">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Użytkownik *</label>
                    <select name="userId" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="city-access-user-select">
                        <option value="">Wybierz użytkownika...</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Miejscowość *</label>
                    <input type="text" name="cityName" required list="city-suggestions" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Wpisz lub wybierz miejscowość...">
                    <datalist id="city-suggestions"></datalist>
                    <p class="mt-1 text-xs text-gray-500">Wpisz nazwę miejscowości dokładnie jak na QNAP lub wybierz z listy</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Notatki</label>
                    <textarea name="notes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Opcjonalne uwagi..."></textarea>
                </div>
                <div id="city-access-active-field" class="hidden">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" name="isActive" class="h-4 w-4 text-blue-600 border-gray-300 rounded" checked>
                        <span class="text-sm text-gray-700">Aktywne przypisanie</span>
                    </label>
                </div>
            </form>
            <div class="px-6 py-4 border-t bg-gray-50 flex justify-end gap-3 rounded-b-xl">
                <button type="button" id="city-access-cancel-btn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">Anuluj</button>
                <button type="submit" form="city-access-form" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Modal przypisania folderu -->
    <div id="folder-access-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-lg border border-gray-200">
            <div class="flex justify-between items-center px-6 py-4 border-b">
                <h3 id="folder-access-modal-title" class="text-lg font-semibold text-gray-800">Nowe przypisanie folderu</h3>
                <button id="folder-access-modal-close" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="folder-access-form" class="px-6 py-4 space-y-4">
                <input type="hidden" name="id" value="">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Użytkownik *</label>
                    <select name="userId" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="folder-access-user-select">
                        <option value="">Wybierz użytkownika...</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Folder KI *</label>
                    <input type="text" name="folderName" required list="folder-suggestions" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Wpisz lub wybierz folder...">
                    <datalist id="folder-suggestions"></datalist>
                    <p class="mt-1 text-xs text-gray-500">Wpisz nazwę folderu dokładnie jak na QNAP lub wybierz z listy</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Notatki</label>
                    <textarea name="notes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Opcjonalne uwagi..."></textarea>
                </div>
                <div id="folder-access-active-field" class="hidden">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" name="isActive" class="h-4 w-4 text-blue-600 border-gray-300 rounded" checked>
                        <span class="text-sm text-gray-700">Aktywne przypisanie</span>
                    </label>
                </div>
            </form>
            <div class="px-6 py-4 border-t bg-gray-50 flex justify-end gap-3 rounded-b-xl">
                <button type="button" id="folder-access-cancel-btn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">Anuluj</button>
                <button type="submit" form="folder-access-form" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Modal przypisania produktu do projektu graficznego -->
    <div id="pm-add-product-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-lg border border-gray-200">
            <div class="flex justify-between items-center px-6 py-4 border-b">
                <h3 class="text-lg font-semibold text-gray-800">Przypisz produkt do projektu</h3>
                <button id="pm-modal-close" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Projekt graficzny</label>
                    <input type="text" id="pm-modal-project-name" readonly class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-700">
                    <input type="hidden" id="pm-modal-project-id">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Szukaj produktu</label>
                    <input type="text" id="pm-product-search-input" placeholder="Wpisz identyfikator lub indeks..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Wybierz produkt *</label>
                    <select id="pm-product-select" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Wybierz produkt --</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">Lista wszystkich aktywnych produktów z bazy danych</p>
                </div>
            </div>
            <div class="px-6 py-4 border-t bg-gray-50 flex justify-end gap-3 rounded-b-xl">
                <button type="button" id="pm-modal-cancel" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">Anuluj</button>
                <button type="button" id="pm-modal-save" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Przypisz</button>
            </div>
        </div>
    </div>

    <!-- Modal formularza produktu -->
    <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl border border-gray-200">
            <div class="flex justify-between items-center px-6 py-4 border-b">
                <h3 id="product-modal-title" class="text-lg font-semibold text-gray-800">Nowy produkt</h3>
                <button id="product-modal-close" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="product-form" class="px-6 py-4 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Identyfikator *</label>
                        <input type="text" name="identifier" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Indeks</label>
                        <input type="text" name="index" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nazwa</label>
                        <input type="text" name="name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Jeśli puste, zostanie użyty identyfikator">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cena *</label>
                        <input type="number" step="0.01" min="0" name="price" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kategoria *</label>
                        <select name="category" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Wybierz kategorię</option>
                        </select>
                        <p class="mt-1 text-xs text-gray-500">Lista kategorii pochodzi z istniejących produktów.</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Kod produktu</label>
                        <input type="text" name="code" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Opcjonalny kod wewnętrzny / ERP">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Dostępność</label>
                        <select name="availability" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Domyślna (AVAILABLE)</option>
                            <option value="AVAILABLE">Dostępny</option>
                            <option value="UNAVAILABLE">Niedostępny</option>
                            <option value="OUT_OF_STOCK">Brak w magazynie</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-2 mt-6">
                        <input type="checkbox" name="isActive" id="field-isActive" class="h-4 w-4 text-blue-600 border-gray-300 rounded" checked>
                        <label for="field-isActive" class="text-sm text-gray-700">Aktywny</label>
                    </div>
                    <div class="flex items-center gap-2 mt-6">
                        <input type="checkbox" name="new" id="field-new" class="h-4 w-4 text-purple-600 border-gray-300 rounded">
                        <label for="field-new" class="text-sm text-gray-700">Nowość</label>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Opis</label>
                    <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Wymiary / parametry</label>
                        <input type="text" name="dimensions" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="np. 5 x 7 cm, materiał, itp.">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ścieżka produkcji</label>
                        <input type="text" name="productionPath" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="np. linia, technologia">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Slug (adres przyjazny)</label>
                        <input type="text" name="slug" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Zostaw puste, aby wygenerować automatycznie w przyszłości">
                    </div>
                </div>
                <div class="mt-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Adres obrazka (URL)</label>
                    <input type="text" name="imageUrl" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://...">
                </div>
                <div id="product-form-error" class="text-sm text-red-600 mt-2 hidden"></div>
                <div class="flex justify-end gap-3 pt-2 border-t mt-4">
                    <button type="button" id="product-form-cancel" class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Anuluj</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                        <i class="fas fa-save"></i>
                        <span>Zapisz</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal edycji stanów magazynowych -->
    <div id="inventory-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-xl border border-gray-200">
            <div class="flex justify-between items-center px-6 py-4 border-b">
                <h3 id="inventory-modal-title" class="text-lg font-semibold text-gray-800">Stany magazynowe</h3>
                <button id="inventory-modal-close" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="inventory-form" class="px-6 py-4 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Stan (stock)</label>
                        <input type="number" name="stock" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="mt-1 text-xs text-gray-500">Aktualny fizyczny stan magazynowy.</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Stan optymalny</label>
                        <input type="number" name="stockOptimal" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="mt-1 text-xs text-gray-500">Docelowy stan, przy którym czujesz się bezpiecznie.</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">W zamówieniu (ordered)</label>
                        <input type="number" name="stockOrdered" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="mt-1 text-xs text-gray-500">Sztuki już zamówione u dostawcy.</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Zarezerwowane</label>
                        <input type="number" name="stockReserved" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="mt-1 text-xs text-gray-500">Sztuki zarezerwowane na konkretne zamówienia.</p>
                    </div>
                </div>
                <div class="flex justify-end gap-3 pt-2 border-t mt-4">
                    <button type="button" id="inventory-form-cancel" class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Anuluj</button>
                    <button type="submit" class="px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 flex items-center gap-2">
                        <i class="fas fa-save"></i>
                        <span>Zapisz stany</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal dodawania/edycji użytkownika -->
    <div id="user-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-xl border border-gray-200">
            <div class="flex justify-between items-center px-6 py-4 border-b">
                <h3 id="user-modal-title" class="text-lg font-semibold text-gray-800">Dodaj nowego użytkownika</h3>
                <button id="user-modal-close" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="user-form" class="px-6 py-4 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Imię i nazwisko *</label>
                    <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Jan Kowalski">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                    <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="jan.kowalski@firma.pl">
                </div>
                <div id="user-password-field">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Hasło *</label>
                    <input type="password" name="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Minimum 6 znaków">
                    <p class="mt-1 text-xs text-gray-500">Hasło musi mieć co najmniej 6 znaków.</p>
                </div>
                <div id="user-password-reset-field" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nowe hasło (opcjonalnie)</label>
                    <input type="password" name="newPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Pozostaw puste aby nie zmieniać">
                    <p class="mt-1 text-xs text-gray-500">Wypełnij tylko jeśli chcesz zmienić hasło użytkownika (min. 6 znaków).</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Rola *</label>
                    <select name="role" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Wybierz rolę</option>
                        <option value="ADMIN">Administrator</option>
                        <option value="SALES_REP">Handlowiec</option>
                        <option value="WAREHOUSE">Magazyn</option>
                        <option value="SALES_DEPT">Dział Sprzedaży</option>
                        <option value="PRODUCTION">Produkcja</option>
                        <option value="GRAPHICS">Graficy</option>
                        <option value="NEW_USER">Nowy Użytkownik</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Dział</label>
                    <select name="departmentId" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Brak działu</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">Opcjonalnie przypisz użytkownika do działu.</p>
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" name="isActive" id="field-user-isActive" class="h-4 w-4 text-blue-600 border-gray-300 rounded" checked>
                    <label for="field-user-isActive" class="text-sm text-gray-700">Konto aktywne</label>
                </div>
                <div id="user-form-error" class="text-sm text-red-600 mt-2 hidden"></div>
                <div class="flex justify-end gap-3 pt-2 border-t mt-4">
                    <button type="button" id="user-form-cancel" class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Anuluj</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                        <i class="fas fa-save"></i>
                        <span>Utwórz użytkownika</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast container -->
    <div id="admin-toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div>

    <style>
        /* Animacje rozwijania/zwijania */
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-15px); max-height: 0; }
            to { opacity: 1; transform: translateY(0); max-height: 1000px; }
        }
        @keyframes slideUp {
            from { opacity: 1; transform: translateY(0); max-height: 1000px; }
            to { opacity: 0; transform: translateY(-15px); max-height: 0; }
        }
        .details-row { animation: slideDown 0.3s ease-out forwards; }
        .chevron-icon { transition: transform 0.2s ease; }
        .chevron-icon.rotated { transform: rotate(90deg); }

        /* Toast notifications */
        .admin-toast {
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: toastIn 0.3s ease-out;
            max-width: 350px;
        }
        .admin-toast.success { background: #10b981; }
        .admin-toast.error { background: #ef4444; }
        .admin-toast.info { background: #3b82f6; }
        .admin-toast.warning { background: #f59e0b; }
        @keyframes toastIn { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }
        @keyframes toastOut { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(100%); } }

        /* Sortowanie kolumn */
        .sortable-header { cursor: pointer; user-select: none; transition: background-color 0.2s; }
        .sortable-header:hover { background-color: #f3f4f6; }
        .sort-icon { margin-left: 4px; opacity: 0.5; }
        .sort-icon.active { opacity: 1; }

        /* Print Preview - orientacja pozioma */
        @media print { @page { size: A4 landscape; margin: 10mm; } }
        .print-document { background: white; padding: 10px; max-width: 100%; margin: 0 auto; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.2; }
        .print-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px; border-bottom: 1px solid #1f2937; padding-bottom: 6px; }
        .print-company { font-size: 14px; font-weight: bold; color: #1f2937; }
        .print-title { font-size: 12px; font-weight: bold; color: #1f2937; margin-top: 2px; }
        .print-meta { font-size: 9px; color: #6b7280; text-align: right; }
        .print-section { margin-bottom: 8px; }
        .print-section-title { font-size: 10px; font-weight: bold; color: #1f2937; margin-bottom: 4px; border-bottom: 1px solid #d1d5db; padding-bottom: 2px; }
        .print-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 6px; }
        .print-field { font-size: 9px; }
        .print-field-label { color: #6b7280; font-weight: 600; margin-bottom: 1px; }
        .print-field-value { color: #1f2937; font-weight: 500; }
        .print-table { width: 100%; border-collapse: collapse; margin-bottom: 8px; font-size: 8px; }
        .print-table thead { background: #f3f4f6; border-bottom: 1px solid #d1d5db; }
        .print-table th { padding: 3px 4px; text-align: left; font-weight: 600; color: #1f2937; font-size: 8px; }
        .print-table td { padding: 3px 4px; border-bottom: 1px solid #e5e7eb; color: #374151; font-size: 8px; }
        .print-table tbody tr:last-child td { border-bottom: none; }
        .print-total { text-align: right; font-size: 10px; font-weight: bold; color: #1f2937; margin-top: 6px; padding-top: 4px; border-top: 1px solid #d1d5db; }
        .print-footer { margin-top: 10px; padding-top: 6px; border-top: 1px solid #e5e7eb; font-size: 8px; color: #6b7280; text-align: center; }

        /* Status select */
        .order-status-select { appearance: none; cursor: pointer; }
    </style>

    <script src="admin.js"></script>
</body>
</html>
